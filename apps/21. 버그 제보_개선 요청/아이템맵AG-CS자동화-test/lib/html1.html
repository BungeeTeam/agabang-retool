<div class="card-container">
{{ (() => {
  const list = get_item_list_new.data 
  if(get_item_list_new.isFetching){
    return `<div style="display: flex; width: 100%;">
      <div style="width: 100%; text-align: center; margin-top: 500px;">
        
      </div>
    </div>`
  }
  
  
  return list.map((item, index) => {
    if(item?.sty_cd?.length<=0){
      return `<div class="card"></div>`
    }
    
    let cat_sex_nm = item.sex_nm === null ? '성별없음': `${item.sex_nm}/ ${item.cat_nm}/ ${item.item_nm}`
    
    return `
      <div class="card" data-click-target="primary-${index}" style="cursor: ${get_item_list_new.isFetching ? 'progress' : 'pointer'}">
        <div class="head" >
          <div class="head-left">
            <b class="head-title">${item.sty_nm}</b>
            <div style="margin-top: 5px;">${item.sty_cd}</div>
          </div>
          <div class="head-right">
            <div style="color:#7b7d7d; padding-bottom: 1px; font-weight: 400;">${item.year_sesn_nm_kor}</div>
            <b>${cat_sex_nm}</b>
          </div>
          
        </div>
    
        <div class="divider" style="margin: 8px 1px;" > </div>
        
    
        <div class="item-body">
          <div class="item-left">
            <img src="https://agabang-image.s3.ap-northeast-2.amazonaws.com/item_final/${ item.sty_cd}${ item.col_cd }.jpg"/>
            <div class="product-layout">
              <div>소재: ${item.fabric ?? ''}</div>
              <div>생산업체: ${item.cust_nm ?? ''}</div>
              <div>생산지역: ${item.prod_country ?? ''}</div>
            </div>
          </div>
    
          <div class="item-right">
            <div class="info-box">
              <div class="info-box-layout"> 
                <b>납기일</b>
                <div class="info-data">${moment(item.deli_dt).format("M/D")}</div>
              </div>
              <div class="info-box-layout"> 
                <b>입고일</b>
                <div class="info-data">${moment(item.fin_date).format("M/D")}</div>
              </div>
              <div class="info-box-layout"> 
                <b>출고일</b>
                <div class="info-data">${moment(item.fout_date).format("M/D")}</div>
              </div>
            </div>
    
    
            <div class="info-box">
              <div class="info-box-layout"> 
                <b>TAG가</b>
                <div class="info-data">${item.tag_prce?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
              </div>
              <div class="info-box-layout"> 
                <b>현판가</b>
                <div class="info-data">${item.f_sale_prce?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
              </div>
              <div class="info-box-layout"> 
                <b>원가(-)</b>
                <div class="info-data">${item.cost_prce?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
              </div>
            </div>
    
    
            <div class="info-box">
              <div class="info-box-layout"> 
                <b>판매수량</b>
                <div class="info-data">${item.tot_sale_qty?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
              </div>
              <div class="info-box-layout" style="width: 60%;"> 
                <b>판매율(수량)</b>
                <div class="info-data">${item.tot_sale_qty_per}</div>
              </div>
            </div>
    
    
    
            <div class="info-box">
              <div class="info-box-layout" style="width: 50%;"> 
                <b>실판매액(천원)</b>
                <div class="info-data">${(Math.round(item.tot_sale_amt/1000))?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
              </div>
              <div class="info-box-layout" style="width: 50%;"> 
                <b>실판매율(금액)</b>
                <div class="info-data">${item.tot_sale_amt_per}</div>
              </div>
            </div>
    
    
            <div class="info-box">
              <div class="info-box-layout"> 
                <b>발주량</b>
                <div class="info-data">${item.plan_qty?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
              </div>
              <div class="info-box-layout"> 
                <b>입고량</b>
                <div class="info-data">${item.tot_in_qty?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
              </div>
              <div class="info-box-layout"> 
                <b>주간판매수량</b>
                <div class="info-data">${item.week_sale_qty?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</div>
              </div>
            </div>
            
            
          </div>
    
          
        </div>
    
    
    
    
    
    
        <div class="middle-layout">
          <div class="middle-border middle-data" style="background-color: ${[JSON.parse(retoolContext.configVars.var_color_dict)[item.col_nm]]}">
            ${item.col_nm}
          </div>
          <div class="middle-data">
            디자이너: ${item.designer_nm}
          </div>
          <div class="middle-data">
            배수: ${item.mark_up}
          </div>
        </div>
    
    
    
    
        <div style="margin: 12px 0;" > </div>
    
    
          
        <div class="table-layout">
          ${item.table_data?.map((tbl) => {
            // col_ 로 시작하는 모든 키 찾기
            const colKeys = Object.keys(tbl || {}).filter(key => key.startsWith('col_')).sort();
            
            return `<div>
              <div class="table-row">
                <div class="table-title">${tbl?.SIZE}</div>
                ${colKeys.map(key => 
                  `<div class="table-data">${tbl[key] ? tbl[key].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : ''}</div>`
                ).join('')}
              </div>
              <div class="divider"></div>
            </div>`
          }).join('')}
        
    
          <div style="margin-top: 5px"> </div>
          
        </div>
    
        
        
      </div>
      `
    }).join('')
  })() 
  
}}
  
  
</div>